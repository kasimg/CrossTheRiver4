{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\GoBtn.js"],"names":["cc","Class","extends","Component","properties","initTimeConsumingSum","timeConsumingSum","moveAnimalsAndLantern","bridgeCom","mainScriptCom","bridgeNode","getComponent","passages","getPassages","lanternCom","lanternNode","timeConsuming","getTimeConsuming","forEach","passage","setTimeConsuming","node","runAction","sequence","crossRiver","callFunc","toggleBridgePosInfo","move","updateTimeConsuming","resumeMouseDownEvents","animalComs","goBtnNode","onMouseDown","removeMouseDownEvents","isEmpty","tween","to","rotation","start","bindMouseDownEvent","on","Node","EventType","MOUSE_DOWN","showTime","timeDisplayer","crossTimeConsumingDisplayer","length","string","appearTween","opacity","hideTime","timer","ifGameOver","gameOver","director","loadScene","onMouseLeave","onMouseEnter","bindMouseEnterEvent","MOUSE_ENTER","bindMouseLeaveEvent","MOUSE_LEAVE","removeMouseDownEvent","off","onLoad"],"mappings":"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","file":"GoBtn.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import { bindCursorEvent, bindScaleEvent, removeMouseDownEvents, resumeMouseDownEvents } from './Utils';\r\n//  go按钮对象\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n  },\r\n\r\n  //  初始化总消耗的时间\r\n  initTimeConsumingSum() {\r\n    this.timeConsumingSum = 0;\r\n  },\r\n\r\n  //  移动动物和灯笼\r\n  moveAnimalsAndLantern() {\r\n    // const bridgeNode = this.mainScriptCom.bridgeNode;\r\n    const bridgeCom = this.mainScriptCom.bridgeNode.getComponent('Bridge');\r\n    const passages = bridgeCom.getPassages();\r\n    // const lanternNode = this.mainScriptCom.lanternNode;\r\n    const lanternCom = this.mainScriptCom.lanternNode.getComponent('Lantern');\r\n    // const \r\n\r\n    //  获取移动时间\r\n    const timeConsuming = bridgeCom.getTimeConsuming();\r\n\r\n    //  乘客移动\r\n    passages.forEach((passage) => {\r\n      passage.setTimeConsuming(timeConsuming / 3);  //  让实际运动时间减少一点\r\n      passage.node.runAction(cc.sequence(passage.crossRiver(), cc.callFunc(() => {\r\n        passage.toggleBridgePosInfo();\r\n        // this.updateTimeConsuming();\r\n      })));\r\n    });\r\n\r\n    //  灯笼移动\r\n    lanternCom.setTimeConsuming(timeConsuming / 3);\r\n    lanternCom.node.runAction(cc.sequence(lanternCom.move(), cc.callFunc(() => {\r\n      lanternCom.toggleBridgePosInfo();\r\n      this.updateTimeConsuming();\r\n\r\n      //  过河之后恢复点击\r\n      resumeMouseDownEvents(...this.mainScriptCom.animalComs, this.mainScriptCom.goBtnNode.getComponent('GoBtn'));\r\n    })))\r\n    // lanternCom.move();\r\n  },\r\n\r\n  //  按钮点击事件\r\n  onMouseDown() {\r\n    const bridgeCom = this.mainScriptCom.bridgeNode.getComponent('Bridge');\r\n\r\n    //  取消所有点击事件\r\n    removeMouseDownEvents(...this.mainScriptCom.animalComs, this.mainScriptCom.goBtnNode.getComponent('GoBtn'));\r\n    if (!bridgeCom.isEmpty()) {\r\n      this.moveAnimalsAndLantern();\r\n      //  改变箭头方向\r\n      // this.node.rotation += 180;\r\n      cc.tween(this.node)\r\n      .to(0.2, { rotation: this.node.rotation + 180 })\r\n      .start();\r\n    } else {\r\n      resumeMouseDownEvents(...this.mainScriptCom.animalComs, this.mainScriptCom.goBtnNode.getComponent('GoBtn'));\r\n    }\r\n  },\r\n\r\n  //  绑定按钮点击事件\r\n  bindMouseDownEvent() {\r\n    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onMouseDown, this);\r\n  },\r\n\r\n  //  显示此次过河需要的时间\r\n  showTime() {\r\n    const bridgeCom = this.mainScriptCom.bridgeNode.getComponent('Bridge');\r\n    const timeDisplayer = this.mainScriptCom.crossTimeConsumingDisplayer;\r\n    if (bridgeCom.getPassages().length > 0) {  //  如果有乘客才显示过河需要花费的时间\r\n      const timeConsuming = bridgeCom.getTimeConsuming();\r\n      //  缓慢浮现时间\r\n      timeDisplayer.string = '此次过河需要' + timeConsuming + '秒';\r\n      const appearTween = cc.tween(timeDisplayer.node)\r\n        .to(0.3, { opacity: 255 });\r\n      appearTween.start();\r\n    }\r\n  },\r\n\r\n  //  取消过河时间的显示\r\n  hideTime() {\r\n    const timeDisplayer = this.mainScriptCom.crossTimeConsumingDisplayer;\r\n    cc.tween(timeDisplayer.node)\r\n      .to(0.3, { opacity: 0 })\r\n      .start();\r\n  },\r\n\r\n  //  更新总耗时的显示\r\n  updateTimeConsuming() {\r\n    // console.log('update')\r\n    const timer = this.mainScriptCom.timer;\r\n    const bridgeCom = this.mainScriptCom.bridgeNode.getComponent('Bridge');\r\n    this.timeConsumingSum += bridgeCom.getTimeConsuming();\r\n    timer.string = '总耗时: ' + this.timeConsumingSum + '秒';\r\n\r\n    //  判断是否游戏结束\r\n    if (this.ifGameOver()) {\r\n      this.gameOver();\r\n    }\r\n  },\r\n\r\n  //  判断游戏是否结束\r\n  ifGameOver() {\r\n    if (this.timeConsumingSum > 30) return true;\r\n    return false;\r\n  },\r\n\r\n  //  游戏结束时进行的操作\r\n  gameOver() {\r\n    cc.director.loadScene('gameOver');\r\n  },\r\n\r\n  //  鼠标离开事件\r\n  onMouseLeave() {\r\n    this.hideTime();\r\n  },\r\n\r\n  //  鼠标悬停事件\r\n  onMouseEnter() {\r\n    this.showTime();\r\n  },\r\n\r\n  //  绑定鼠标悬停事件\r\n  bindMouseEnterEvent() {\r\n    this.node.on(cc.Node.EventType.MOUSE_ENTER, this.onMouseEnter, this);\r\n  },\r\n\r\n  //  绑定鼠标离开事件\r\n  bindMouseLeaveEvent() {\r\n    this.node.on(cc.Node.EventType.MOUSE_LEAVE, this.onMouseLeave, this);\r\n  },\r\n\r\n  //  移除鼠标点击事件\r\n  removeMouseDownEvent() {\r\n    this.node.off(cc.Node.EventType.MOUSE_DOWN, this.onMouseDown, this);\r\n  },\r\n\r\n  onLoad() {\r\n    this.initTimeConsumingSum();\r\n    this.bindMouseDownEvent();\r\n    this.bindMouseEnterEvent();\r\n    this.bindMouseLeaveEvent();\r\n    bindCursorEvent(this.node, this);\r\n    bindScaleEvent(this.node, this, 0.2);\r\n    // this.updateTimeConsuming();\r\n    // this.node.on(cc.Node.EventType.MOUSE_ENTER, () => {console.log('a')}, this);\r\n    // this.node.on(cc.Node.EventType.MOUSE_ENTER, () => {console.log('b')}, this);\r\n  },\r\n\r\n  start() {\r\n\r\n  },\r\n\r\n  // update (dt) {},\r\n});\r\n"]}